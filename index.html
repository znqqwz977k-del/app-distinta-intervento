<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Distinta Intervento - Daikin Aerotech</title>

<style>
:root{
  --primary:#0b74c6;
  --bg:#f3f5f7;
  --card:#ffffff;
  --border:#d1d5db;
}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
  background:var(--bg);
  padding:14px;
}
.wrap{max-width:820px;margin:auto;}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  margin-bottom:14px;
}
.logo{text-align:center;}
.logo img{max-width:520px;width:100%;}
h1{text-align:center;margin:8px 0 12px;}
label{font-weight:700;font-size:13px;margin-top:10px;display:block;}
input,select,textarea{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid var(--border);
  font-size:15px;
}
textarea{min-height:80px;}
button{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:none;
  font-size:16px;
  font-weight:800;
  cursor:pointer;
}
.primary{background:var(--primary);color:#fff;}
.light{background:#eef2f7;border:1px solid var(--border);}
.danger{background:#ef4444;color:#fff;}
canvas{
  width:100%;height:160px;
  border:1px solid var(--border);
  border-radius:10px;
}
.row{display:grid;gap:10px;}
@media(min-width:700px){.two{grid-template-columns:1fr 1fr;}}
</style>
</head>

<body>
<div class="wrap">

<div class="card">
  <div class="logo"><img src="logo-daikin.jpg"></div>
  <h1>Distinta Intervento</h1>
</div>

<div class="card row two">
  <div>
    <label>Data</label>
    <input id="data" type="date">
  </div>
  <div>
    <label>Cliente</label>
    <input id="cliente">
  </div>
</div>

<div class="card">
  <label>Indirizzo intervento</label>
  <input id="indirizzo">

  <label>Tecnico / Squadra</label>
  <input id="tecnico">

  <label>Tipo intervento</label>
  <select id="tipo">
    <option>Installazione</option>
    <option>Manutenzione</option>
    <option>Riparazione</option>
    <option>Sopralluogo</option>
  </select>

  <label>Materiali utilizzati</label>
  <textarea id="materiali"></textarea>
</div>

<div class="card">
  <h3>Firma Tecnico</h3>
  <canvas id="firmaTecnico"></canvas>
  <button class="light" onclick="clearCanvas('firmaTecnico')">Cancella firma</button>

  <h3>Firma Cliente</h3>
  <canvas id="firmaCliente"></canvas>
  <button class="light" onclick="clearCanvas('firmaCliente')">Cancella firma</button>
</div>

<div class="card">
  <button class="light" onclick="inizioLavoro()">üìç INIZIO LAVORO</button>
  <button class="primary" onclick="invia()">üì§ INVIA DOCUMENTO</button>
</div>

</div>

<script>
let startPos=null;

function gps(cb){
  navigator.geolocation.getCurrentPosition(
    p=>cb(p.coords.latitude,p.coords.longitude),
    ()=>alert("GPS non disponibile"),
    {enableHighAccuracy:true}
  );
}

function inizioLavoro(){
  gps((lat,lng)=>{
    startPos={lat,lng,time:new Date().toLocaleString()};
    alert("Inizio lavoro registrato");
  });
}

function invia(){
  if(!cliente.value||!indirizzo.value||!tecnico.value||!materiali.value)
    return alert("Compila tutti i campi");
  if(!startPos) return alert("Premi prima INIZIO LAVORO");

  gps((lat,lng)=>{
    const maps=`https://maps.google.com/?q=${lat},${lng}`;
    const testo=
`DAIKIN AEROTECH ‚Äì FINE INTERVENTO

Cliente: ${cliente.value}
Indirizzo: ${indirizzo.value}
Tecnico: ${tecnico.value}
Tipo: ${tipo.value}

Materiali:
${materiali.value}

Inizio lavoro:
${startPos.time}
Posizione inizio:
https://maps.google.com/?q=${startPos.lat},${startPos.lng}

Uscita dal luogo:
${new Date().toLocaleString()}
Posizione uscita:
${maps}`;

    window.open(
      "https://t.me/share/url?text="+encodeURIComponent(testo),
      "_blank"
    );
  });
}

function draw(c){
  const ctx=c.getContext("2d");
  let d=false;
  c.addEventListener("mousedown",()=>d=true);
  c.addEventListener("mouseup",()=>{d=false;ctx.beginPath();});
  c.addEventListener("mousemove",e=>{
    if(!d)return;
    ctx.lineWidth=2;
    ctx.lineTo(e.offsetX,e.offsetY);
    ctx.stroke();
  });
}
function clearCanvas(id){
  const c=document.getElementById(id);
  c.getContext("2d").clearRect(0,0,c.width,c.height);
}
["firmaTecnico","firmaCliente"].forEach(id=>draw(document.getElementById(id)));

data.value=new Date().toISOString().slice(0,10);
</script>
</body>
</html>
